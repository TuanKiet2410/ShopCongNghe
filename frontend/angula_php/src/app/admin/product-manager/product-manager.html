<div class="card shadow-sm">

  <!-- HEADER -->
  <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
    <h5 class="mb-0 fw-bold">Kho Sản Phẩm</h5>
    <button class="btn btn-primary btn-sm" (click)="openModal()">
      + Thêm Sản Phẩm
    </button>
  </div>

  <!-- TABLE -->
  <div class="table-responsive">
    <table class="table table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>Ảnh</th>
          <th>Tên SP</th>
          <th>Giá</th>
          <th>Kho</th>
          <th width="120">Hành động</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let pr of products(); trackBy: trackById">
          <td class="img-box">
            <img [src]="pr.image || 'images/avatarBook.png'" class="rounded" width="60" />
          </td>
          <td>{{ pr.name }}</td>
          <td>{{ pr.price | number }} ₫</td>
          <td>{{ pr.stock }}</td>
          <td>
            <button
              class="btn btn-sm btn-info text-white me-1"
              (click)="editProduct(pr)"
            >
              <i class="bi bi-pencil"></i>
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="deleteProduct(pr.id!)"
            >
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
        
        <tr *ngIf="products().length === 0">
          <td colspan="5" class="text-center text-muted py-4">
            Không có sản phẩm
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  <div class="pagination p-3 justify-content-center" *ngIf="totalPages > 1">
    <button
      class="btn btn-sm btn-outline-secondary me-1"
      (click)="goToPage(currentPage - 1)"
      [disabled]="currentPage === 1"
    >
      «
    </button>

    <button
      class="btn btn-sm"
      *ngFor="let page of pageNumbers"
      (click)="goToPage(page)"
      [class.btn-primary]="currentPage === page"
      [class.btn-outline-secondary]="currentPage !== page"
    >
      {{ page }}
    </button>

    <button
      class="btn btn-sm btn-outline-secondary ms-1"
      (click)="goToPage(currentPage + 1)"
      [disabled]="currentPage === totalPages"
    >
      »
    </button>
  </div>
</div>

<!-- MODAL -->
<div
  class="modal fade"
  id="modalId"
  tabindex="-1"
  data-bs-backdrop="static"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          {{ isEditMode ? 'Cập nhật sản phẩm' : 'Thêm sản phẩm' }}
        </h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="submitForm()">
        <div class="modal-body">

          <!-- IMAGE -->
          <div class="mb-3 text-center">
            <img
              [src]="productForm.value.image || 'images/avatarBook.png'"
              class="img-thumbnail mb-2"
              style="max-height: 250px; cursor: pointer"
              (click)="fileInput.click()"
            />
            <input
              type="file"
              hidden
              #fileInput
              accept="image/*"
              (change)="onFileSelected($event)"
            />
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Tên sản phẩm</label>
              <input class="form-control" formControlName="name" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Giá</label>
              <input type="number" class="form-control" formControlName="price" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Danh mục</label>
              <input class="form-control" formControlName="category" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Thương hiệu</label>
              <input class="form-control" formControlName="brand" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Tồn kho</label>
              <input type="number" class="form-control" formControlName="stock" />
            </div>

            <div class="col-12">
              <label class="form-label">Mô tả</label>
              <textarea
                class="form-control"
                rows="3"
                formControlName="description"
              ></textarea>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Hủy
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="productForm.invalid"
          >
            {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
          </button>
        </div>
      </form>

    </div>
  </div>
</div>
